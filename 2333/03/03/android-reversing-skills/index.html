<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title> Android é€†å‘æŠ€å·§æ€»ç»“ Â· kiya </title>
    <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<link rel="stylesheet" href="/style/style.css">
<script src="/script/jquery.min.js"></script>
<script>
    var CONFIG = {
        title: "kiya",
        author: "kiya",
        lightbox: true,
        animate: true
    }
</script>



    <link rel="stylesheet" href="/lightbox/css/lightbox.min.css">




    <link rel="stylesheet" href="/syuanpi/syuanpi.min.css">




    <link rel="icon" href="https://dn-coding-net-production-pp.qbox.me/159e486a-e407-4f88-8289-1ff286338478.png">







</head>
<body>
    <div class="progress">
    <div class="progress-inner"></div>
</div>
    <div class="body">
    <div class="tagcloud" id="tagcloud">
    <div class="tagcloud-inner">
        <a href="/tags/CTF/" style="font-size: 14px;">CTF</a> <a href="/tags/MSC/" style="font-size: 14px;">MSC</a> <a href="/tags/Python/" style="font-size: 14px;">Python</a> <a href="/tags/Xposed/" style="font-size: 14px;">Xposed</a> <a href="/tags/anti-debug/" style="font-size: 14px;">anti-debug</a> <a href="/tags/arm/" style="font-size: 14px;">arm</a> <a href="/tags/compile/" style="font-size: 14px;">compile</a> <a href="/tags/dalvik/" style="font-size: 14px;">dalvik</a> <a href="/tags/debug/" style="font-size: 14px;">debug</a> <a href="/tags/dex/" style="font-size: 14px;">dex</a> <a href="/tags/enforce/" style="font-size: 14px;">enforce</a> <a href="/tags/hook/" style="font-size: 14px;">hook</a> <a href="/tags/ida/" style="font-size: 14px;">ida</a> <a href="/tags/instruction/" style="font-size: 14px;">instruction</a> <a href="/tags/ndk/" style="font-size: 14px;">ndk</a> <a href="/tags/reverse/" style="font-size: 14px;">reverse</a> <a href="/tags/reversing/" style="font-size: 14px;">reversing</a> <a href="/tags/smali/" style="font-size: 14px;">smali</a> <a href="/tags/tools/" style="font-size: 14px;">tools</a> <a href="/tags/translation/" style="font-size: 14px;">translation</a>
    </div>
</div>
    <header class="header" id="header">
    <div class="title syuanpi tvIn">
    <div class="table">
        <div class="connect">
            <div class="connect-inner">
                <span><a href="/">kiya</a></span>
                
                    <span id="subtitle">ä¸–ç•Œã¯ä»Šæ—¥ã‚‚å¹³å’Œã§ã™ã­ãƒ¼</span>
                
            </div>
        </div>
    </div>
</div>
    <nav class="main-nav syuanpi tvIn">
<div class="table">

    <ul class="menu">
        
        <li class="menu-item">
            <a href="javascript:;" id="search">
                <span>æœç´¢</span>
                
                    <span class="menu-item-label">search</span>
                
            </a>
        </li>
        
        
        
            <li class="menu-item">
                <a href="/">
                    <span>æ–‡ç« </span>
                    
                        <span class="menu-item-label">article</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/archives">
                    <span>å½’æ¡£</span>
                    
                        <span class="menu-item-label">archives</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="javascript:;" id="tags">
                    <span>æ ‡ç­¾</span>
                    
                        <span class="menu-item-label">tags</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/about">
                    <span>å…³äº</span>
                    
                        <span class="menu-item-label">about</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/atom.xml">
                    <span>è®¢é˜…</span>
                    
                        <span class="menu-item-label">RSS</span>
                    
                </a>
            </li>
        
        
    </ul>

</div>
</nav>
<div class="mobile-nav"></div>
</header>
    <div class="container">
        <main class="main" id="main">
            
    
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>2333å¹´3æœˆ3æ—¥</span>
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                Android é€†å‘æŠ€å·§æ€»ç»“
            
            </h1>
            
                
                    <div class="post-tags syuanpi riseIn-light back-3">
                    
                        <a href="/tags/reversing/">reversing</a>
                    
                        <a href="/tags/CTF/">CTF</a>
                    
                    </div>
                
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                <p>ä»¥ä»£è¡¨æ€§çš„ crackme ä¸ºä¾‹æ€»ç»“ç›¸å…³çŸ¥è¯†ç‚¹ã€‚ä¸€ç·’ã«é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼github ä»“åº“<a href="https://github.com/kiya-z/android-reversing-challenges" target="_blank" rel="external">åœ¨æ­¤</a>ã€‚<br><a id="more"></a></p>
<h1 id="JNI-Onload-ä¸­é€šè¿‡-RegisterNatives-åŠ¨æ€æ³¨å†Œ-jni-å‡½æ•°"><a href="#JNI-Onload-ä¸­é€šè¿‡-RegisterNatives-åŠ¨æ€æ³¨å†Œ-jni-å‡½æ•°" class="headerlink" title="JNI_Onload ä¸­é€šè¿‡ RegisterNatives åŠ¨æ€æ³¨å†Œ jni å‡½æ•°"></a>JNI_Onload ä¸­é€šè¿‡ RegisterNatives åŠ¨æ€æ³¨å†Œ jni å‡½æ•°</h1><p><strong>ç›¸å…³å‡½æ•°</strong>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">signed int __fastcall JNI_OnLoad(_JavaVM *a1)</div><div class="line"></div><div class="line">((int (__fastcall *)(_JavaVM *, _JNIEnv **, signed int))v1-&gt;functions-&gt;GetEnv)(v1, &amp;v8, 65540)  </div><div class="line">    /*  v1:JavaVM  v8:JniEnv  65540:jni version */</div><div class="line"></div><div class="line">((int (__fastcall *)(_JNIEnv *, char *))v3-&gt;functions-&gt;FindClass)(v3, v4)   </div><div class="line">    /*  v3:JNIEnv  v4:ç±»å    */</div><div class="line"></div><div class="line">((int (__fastcall *)(_JNIEnv *, int, char **, signed int))v3-&gt;functions-&gt;RegisterNatives)(v3, v5, off_400C, 2)</div><div class="line">    /*  v3:JniEnv  v5:FindClasså¾—åˆ°çš„jclasså¯¹è±¡  off_400C:è¦æ³¨å†Œçš„methods  2:æ³¨å†Œçš„methodsä¸ªæ•°</div><div class="line">        methodçš„æ ¼å¼ä¸ºï¼šå‡½æ•°å å‡½æ•°æè¿°(smaliæ ¼å¼) å‡½æ•°æŒ‡é’ˆ</div><div class="line">        ä¾‹å¦‚(in ida)ï¼š</div><div class="line">            DCD aHello              ; &quot;hello&quot;</div><div class="line">            DCD aLjavaLangStr_1     ; &quot;()Ljava/lang/String;&quot;</div><div class="line">            DCD native_hello+1</div><div class="line">    */</div></pre></td></tr></table></figure>
<p><strong>ä¾‹ï¼š</strong><a href="https://github.com/kiya-z/android-reversing-challenges/tree/master/apks/mobicrackNDK.apk" target="_blank" rel="external">mobicrackNDK.apk</a></p>
<h1 id="init-array"><a href="#init-array" class="headerlink" title=".init_array"></a>.init_array</h1><p>æ ¹æ® linker æºç , section çš„æ‰§è¡Œé¡ºåºä¸º <code>.preinit_array</code> -&gt; <code>.init</code> -&gt; <code>.init_array</code> ã€‚ä½† so æ˜¯ä¸ä¼šæ‰§è¡Œ <code>.preinit_array</code> çš„, å¯ä»¥å¿½ç•¥ã€‚</p>
<p><code>.init_array</code> æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆæ•°ç»„ã€‚ç¼–å†™ä»£ç æ—¶åœ¨å‡½æ•°å£°æ˜æ—¶åŠ ä¸Š <code>__attribute__((constructor))</code> ä½¿ä¹‹æˆä¸ºå…±äº«æ„é€ å‡½æ•°ï¼Œå³å¯ä½¿è¯¥å‡½æ•°å‡ºç°åœ¨ <code>.init_array</code> section ä¸­ã€‚</p>
<p>IDA åŠ¨æ€è°ƒè¯•æ—¶ â€˜ctrl+sâ€™ æŸ¥çœ‹ section ä¿¡æ¯å³å¯å®šä½è¿™ä¸¤ä¸ª setctionï¼Œç‰¹åˆ«çš„ï¼Œå¯¹äº <code>.init_array</code>ï¼Œå¯é€šè¿‡æœç´¢ <code>Calling %s @ %p for &#39;%s&#39;</code> å®šä½ã€‚</p>
<p><strong>éƒ¨åˆ†æºç </strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">void soinfo::CallConstructors() &#123;</div><div class="line">    ...</div><div class="line">    // DT_INIT should be called before DT_INIT_ARRAY if both are present.</div><div class="line">    CallFunction(&quot;DT_INIT&quot;, init_func);</div><div class="line">    CallArray(&quot;DT_INIT_ARRAY&quot;, init_array, init_array_count, false);    // CallArray ä¸­ä¹Ÿä¼šè°ƒç”¨ CallFunction å‡½æ•°</div><div class="line">&#125;</div><div class="line"></div><div class="line">void soinfo::CallFunction(const char* function_name UNUSED, linker_function_t function) &#123;</div><div class="line">  if (function == NULL || reinterpret_cast&lt;uintptr_t&gt;(function) == static_cast&lt;uintptr_t&gt;(-1)) &#123;</div><div class="line">    return;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  TRACE(&quot;[ Calling %s @ %p for &apos;%s&apos; ]&quot;, function_name, function, name);</div><div class="line">  function();</div><div class="line">  TRACE(&quot;[ Done calling %s @ %p for &apos;%s&apos; ]&quot;, function_name, function, name);</div><div class="line"></div><div class="line">  // The function may have called dlopen(3) or dlclose(3), so we need to ensure our data structures</div><div class="line">  // are still writable. This happens with our debug malloc (see http://b/7941716).</div><div class="line">  set_soinfo_pool_protection(PROT_READ | PROT_WRITE);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>ä¾‹ï¼š</strong><a href="https://github.com/kiya-z/android-reversing-challenges/tree/master/apks/mobicrackNDK.apk" target="_blank" rel="external">mobicrackNDK.apk</a></p>
<h1 id="dex-ç»“æ„"><a href="#dex-ç»“æ„" class="headerlink" title="dex ç»“æ„"></a>dex ç»“æ„</h1><h2 id="ä¿®å¤-dexHeader-amp-onCreate"><a href="#ä¿®å¤-dexHeader-amp-onCreate" class="headerlink" title="ä¿®å¤ dexHeader &amp; onCreate"></a>ä¿®å¤ dexHeader &amp; onCreate</h2><p>å¿«é€Ÿç®€è®°ï¼š</p>
<table>
<thead>
<tr>
<th>ç»“æ„</th>
<th>å•ä½ç»“æ„ä½“å å­—èŠ‚</th>
<th>å…±è®¡å­—èŠ‚</th>
</tr>
</thead>
<tbody>
<tr>
<td>DexHeader</td>
<td>-</td>
<td>0x70h</td>
</tr>
<tr>
<td>String Table</td>
<td>4</td>
<td>-</td>
</tr>
<tr>
<td>Type Table</td>
<td>4</td>
<td>-</td>
</tr>
<tr>
<td>Proto Table</td>
<td>12</td>
<td>-</td>
</tr>
<tr>
<td>Field Table</td>
<td>8</td>
<td>-</td>
</tr>
<tr>
<td>Method Table</td>
<td>8</td>
<td>-</td>
</tr>
<tr>
<td>Class Def Table</td>
<td>32</td>
<td>-</td>
</tr>
<tr>
<td>Data Section(å«Map Section)</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>ä¾‹ï¼š</strong><a href="https://github.com/kiya-z/android-reversing-challenges/tree/master/apks/misc.apk" target="_blank" rel="external">misc.apk</a></p>
<h1 id="hook-ç³»ç»Ÿå‡½æ•°"><a href="#hook-ç³»ç»Ÿå‡½æ•°" class="headerlink" title="hook ç³»ç»Ÿå‡½æ•°"></a>hook ç³»ç»Ÿå‡½æ•°</h1><p><strong>ä¾‹ï¼š</strong><a href="https://github.com/kiya-z/android-reversing-challenges/tree/master/apks/EasyRe.apk" target="_blank" rel="external">EasyRe.apk</a></p>
<h1 id="dump-å†…å­˜æœç´¢-flag"><a href="#dump-å†…å­˜æœç´¢-flag" class="headerlink" title="dump å†…å­˜æœç´¢ flag"></a>dump å†…å­˜æœç´¢ flag</h1><h2 id="1-åˆ©ç”¨-ddms-çš„-dump-HPROF-file-åŠŸèƒ½-å¸¦ç®­å¤´çš„æ²¹æ¡¶å›¾æ ‡"><a href="#1-åˆ©ç”¨-ddms-çš„-dump-HPROF-file-åŠŸèƒ½-å¸¦ç®­å¤´çš„æ²¹æ¡¶å›¾æ ‡" class="headerlink" title="1. åˆ©ç”¨ ddms çš„ dump HPROF file åŠŸèƒ½ (å¸¦ç®­å¤´çš„æ²¹æ¡¶å›¾æ ‡)"></a>1. åˆ©ç”¨ ddms çš„ <code>dump HPROF file</code> åŠŸèƒ½ (å¸¦ç®­å¤´çš„æ²¹æ¡¶å›¾æ ‡)</h2><p>æœç´¢ï¼š<code>strings easyre.sjl.gossip.easyre.hprof | grep 0ctf</code></p>
<h2 id="2-åˆ©ç”¨-gore"><a href="#2-åˆ©ç”¨-gore" class="headerlink" title="2. åˆ©ç”¨ gore"></a>2. åˆ©ç”¨ gore</h2><p>gdb é™„åŠ è¿›ç¨‹åç›´æ¥æ‰§è¡Œ <code>gcore</code> dumpï¼Œæœç´¢ï¼š<code>strings core.7967 | grep 0ctf</code></p>
<p><strong>ä¾‹ï¼š</strong><a href="https://github.com/kiya-z/android-reversing-challenges/tree/master/apks/EasyRe.apk" target="_blank" rel="external">EasyRe.apk</a></p>
<h1 id="ä¿®æ”¹-smali-ä»£ç "><a href="#ä¿®æ”¹-smali-ä»£ç " class="headerlink" title="ä¿®æ”¹ smali ä»£ç "></a>ä¿®æ”¹ smali ä»£ç </h1><p>æŒ‡ä»¤å‚è€ƒè¿™é‡ŒğŸ‘‰<a href="https://source.android.com/devices/tech/dalvik/dalvik-bytecode" target="_blank" rel="external">dalvik bytecode</a></p>
<p><strong>ä¾‹ï¼š</strong><a href="https://github.com/kiya-z/android-reversing-challenges/tree/master/apks/Timer.apk" target="_blank" rel="external">Timer.apk</a></p>
<h1 id="ARM"><a href="#ARM" class="headerlink" title="ARM"></a>ARM</h1><h2 id="ARM-çš„å‚æ•°ä¼ é€’è§„åˆ™"><a href="#ARM-çš„å‚æ•°ä¼ é€’è§„åˆ™" class="headerlink" title="ARM çš„å‚æ•°ä¼ é€’è§„åˆ™"></a>ARM çš„å‚æ•°ä¼ é€’è§„åˆ™</h2><p>R0ã€R1ã€R2ã€R3ï¼Œ åœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œç”¨æ¥å­˜æ”¾å‰4ä¸ªå‡½æ•°å‚æ•°ï¼›å¦‚æœå‡½æ•°çš„å‚æ•°å¤šäº 4 ä¸ªï¼Œåˆ™å¤šä½™å‚æ•°å­˜æ”¾åœ¨å †æ ˆå½“ä¸­ï¼›<br>ä½äº32ä½çš„å‡½æ•°è¿”å›å€¼å­˜äº R0ã€‚</p>
<h2 id="ARM-çš„å¯„å­˜å™¨è§„åˆ™"><a href="#ARM-çš„å¯„å­˜å™¨è§„åˆ™" class="headerlink" title="ARM çš„å¯„å­˜å™¨è§„åˆ™"></a>ARM çš„å¯„å­˜å™¨è§„åˆ™</h2><table>
<thead>
<tr>
<th>å¯„å­˜å™¨</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>R0 ~ R3</td>
<td>è°ƒç”¨å‡½æ•°æ—¶ï¼Œç”¨æ¥å­˜æ”¾å‰4ä¸ªå‡½æ•°å‚æ•°</td>
</tr>
<tr>
<td>R0</td>
<td>å‡½æ•°è¿”å›æ—¶ï¼Œå­˜æ”¾ä½äº32ä½çš„å‡½æ•°è¿”å›å€¼</td>
</tr>
<tr>
<td>R4 ~ R11</td>
<td>ä¿å­˜å±€éƒ¨å˜é‡ã€‚è¿›å…¥å‡½æ•°æ—¶å¿…é¡»ä¿å­˜æ‰€ç”¨åˆ°çš„å±€éƒ¨å˜é‡å¯„å­˜å™¨çš„å€¼ï¼Œåœ¨è¿”å›å‰å¿…é¡»æ¢å¤è¿™äº›å¯„å­˜å™¨çš„å€¼ï¼›å¯¹äºå‡½æ•°ä¸­æ²¡æœ‰ç”¨åˆ°çš„å¯„å­˜å™¨åˆ™ä¸å¿…è¿›è¡Œè¿™äº›æ“ä½œã€‚<br>åœ¨Thumbä¸­ï¼Œé€šå¸¸åªèƒ½ä½¿ç”¨å¯„å­˜å™¨ R4~R7æ¥ä¿å­˜å±€éƒ¨å˜é‡ï¼Œ<br>æ‰€ä»¥å‡½æ•°å†…éƒ¨é€šç”¨çš„å…¥æ ˆå‡ºæ ˆä»£ç å¯ä»¥ä¸ºï¼š<br>STMFD sp!,{r4-r11,lr}<br>// body of ASM code<br>LDMFD sp!,{r4-r11,pc}</td>
</tr>
<tr>
<td>R12</td>
<td>ç”¨ä½œ IPï¼Œå†…éƒ¨è°ƒç”¨æš‚æ—¶å¯„å­˜å™¨</td>
</tr>
<tr>
<td>R13</td>
<td>ç”¨ä½œ SPï¼Œæ ˆæŒ‡é’ˆï¼Œsp ä¸­å­˜æ”¾çš„å€¼åœ¨é€€å‡ºè¢«è°ƒç”¨å‡½æ•°æ—¶å¿…é¡»ä¸è¿›å…¥æ—¶çš„å€¼ç›¸åŒã€‚</td>
</tr>
<tr>
<td>R14</td>
<td>ç”¨ä½œ LRï¼Œé“¾æ¥å¯„å­˜å™¨ï¼Œä¿å­˜å‡½æ•°çš„è¿”å›åœ°å€ï¼›å¦‚æœåœ¨å‡½æ•°ä¸­ä¿å­˜äº†è¿”å›åœ°å€ï¼Œå¯„å­˜å™¨R14 åˆ™å¯ä»¥ç”¨ä½œå…¶ä»–ç”¨é€”</td>
</tr>
<tr>
<td>R15</td>
<td>ç”¨ä½œ PCï¼Œç¨‹åºè®¡æ•°å™¨</td>
</tr>
<tr>
<td>R16</td>
<td>CPSRï¼ŒçŠ¶æ€å¯„å­˜å™¨</td>
</tr>
</tbody>
</table>
<p><strong>ä¾‹ï¼š</strong><a href="https://github.com/kiya-z/android-reversing-challenges/tree/master/apks/LoopAndLoop.apk" target="_blank" rel="external">LoopAndLoop.apk</a></p>
<h1 id="å„ç§æ£€æµ‹"><a href="#å„ç§æ£€æµ‹" class="headerlink" title="å„ç§æ£€æµ‹"></a>å„ç§æ£€æµ‹</h1><h2 id="dex-æ ¡éªŒ"><a href="#dex-æ ¡éªŒ" class="headerlink" title="dex æ ¡éªŒ"></a>dex æ ¡éªŒ</h2><p>SHA1 å€¼ã€‚</p>
<h2 id="åè°ƒè¯•"><a href="#åè°ƒè¯•" class="headerlink" title="åè°ƒè¯•"></a>åè°ƒè¯•</h2><ol>
<li>è¯»å– /proc/pid/status çš„ State æ˜¯å¦ä¸º t</li>
<li>è¯»å– /proc/pid/status çš„ TracerPid æ˜¯å¦ä¸ä¸º0</li>
<li>è¯»å– /proc/pid/wchan æ˜¯å¦æœ‰ ptrace_stop</li>
</ol>
<p><strong>ä¾‹ï¼š</strong><a href="https://github.com/kiya-z/android-reversing-challenges/tree/master/apks/KXCTF.apk" target="_blank" rel="external">KXCTF.apk</a></p>
<h1 id="å»èŠ±"><a href="#å»èŠ±" class="headerlink" title="å»èŠ±"></a>å»èŠ±</h1><p>å»èŠ±å³å°†è§„å¾‹çš„èŠ±æŒ‡ä»¤ nop æ‰å¹¶ä¿®å¤è·³è½¬ï¼Œida ä¸­çš„å»èŠ±è„šæœ¬ç¼–å†™å¯å‚è€ƒ IDA çš„ idc æˆ– idapython APIã€‚</p>
<p>ä¸ºäº†ä½¿ IDA è¯†åˆ«æŸä¸ªå‡½æ•°Xï¼Œéœ€è¦åœ¨ Functions Window <strong>ç»Ÿç»Ÿåˆ é™¤</strong>ä¹‹å‰å‡½æ•°Xä¸­è¯¯å°† junk code è¯†åˆ«ä¸ºå‡½æ•°çš„åƒåœ¾å‡½æ•°ï¼Œæ‰‹åŠ¨<strong>è®¾ç½®å‡½æ•°Xçš„ç»“å°¾</strong>ï¼ˆEdit - Functions - set function endï¼‰ã€‚</p>
<p><strong>å‡½æ•°å°¾éƒ¨ç‰¹å¾ï¼š</strong></p>
<ol>
<li><code>BLX   __stack_chk_fail</code>  -&gt; å †æ ˆä¿æŠ¤</li>
<li><code>POP   {R4-R7,PC} (ä¸å‡½æ•°å¤´ PUSH {R4-R7,LR} å¯¹åº”)</code>  -&gt; å †æ ˆå¹³è¡¡</li>
</ol>
<p><strong>ä¾‹ï¼š</strong><a href="https://github.com/kiya-z/android-reversing-challenges/tree/master/apks/rfchen.apk" target="_blank" rel="external">rfchen.apk</a></p>
<h1 id="åŠ å¯†ç®—æ³•"><a href="#åŠ å¯†ç®—æ³•" class="headerlink" title="åŠ å¯†ç®—æ³•"></a>åŠ å¯†ç®—æ³•</h1><h2 id="DES-åŠ å¯†"><a href="#DES-åŠ å¯†" class="headerlink" title="DES åŠ å¯†"></a>DES åŠ å¯†</h2><p>å¯¹ç§°æ€§åŠ å¯†ï¼Œå…¸å‹çš„ DES ä»¥<code>64 ä½äºŒè¿›åˆ¶ä¸ºåˆ†ç»„</code>å¯¹æ•°æ®åŠ å¯†ã€‚<br>å¦‚æœæ˜æ–‡ä¸æ˜¯ 64 ä½ï¼ˆ16ä¸ª16è¿›åˆ¶ä½ï¼‰çš„æ•´æ•°å€ï¼Œåˆ™åŠ å¯†å‰ï¼Œè¿™æ®µæ–‡æœ¬å¿…é¡»<code>åœ¨å°¾éƒ¨è¡¥å……ä¸€äº›é¢å¤–çš„å­—èŠ‚</code>ã€‚<br>åœ¨è¿ç®—æ—¶éœ€è¦æ ¹æ®<code>ç‰¹å®šçš„è¡¨æ ¼</code>ä»¥ 64 ä½ä¸ºå•ä½å¯¹æ˜æ–‡å’Œç§˜é’¥åˆ†åˆ«è¿›è¡Œ<code>ç½®æ¢æ“ä½œ</code>ã€‚</p>
<p><strong>ä¾‹ï¼š</strong><a href="https://github.com/kiya-z/android-reversing-challenges/tree/master/apks/KXCTF.apk" target="_blank" rel="external">KXCTF.apk</a></p>
<h2 id="RC6-åŠ å¯†"><a href="#RC6-åŠ å¯†" class="headerlink" title="RC6 åŠ å¯†"></a>RC6 åŠ å¯†</h2><p>å¯¹ç§°æ€§åŠ å¯†ã€‚ä¸»è¦æ“ä½œæ˜¯<code>å¼‚æˆ–å’Œå¾ªç¯å·¦ç§»</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">// Encryption/Decryption with RC6-w/r/b</div><div class="line">//</div><div class="line">// Input:   Plaintext stored in four w-bit input registers A, B, C &amp; D</div><div class="line">//  r is the number of rounds</div><div class="line">//  w-bit round keys S[0, ... , 2r + 3]</div><div class="line">//</div><div class="line">// Output: Ciphertext stored in A, B, C, D</div><div class="line">//</div><div class="line">// &apos;&apos;&apos;Encryption Procedure:&apos;&apos;&apos;</div><div class="line"></div><div class="line">  B = B + S[0]</div><div class="line">  D = D + S[1]</div><div class="line">  for i = 1 to r do</div><div class="line">  &#123;</div><div class="line">    t = (B*(2B + 1)) &lt;&lt;&lt; lg w</div><div class="line">    u = (D*(2D + 1)) &lt;&lt;&lt; lg w</div><div class="line">    A = ((A âŠ• t) &lt;&lt;&lt; u) + S[2i]</div><div class="line">    C = ((C âŠ• u) &lt;&lt;&lt; t) + S[2i + 1]</div><div class="line">                (A, B, C, D)  =  (B, C, D, A)</div><div class="line">  &#125;</div><div class="line">  A = A + S[2r + 2]</div><div class="line">  C = C + S[2r + 3]</div></pre></td></tr></table></figure>
<p><strong>ä¾‹ï¼š</strong><a href="https://github.com/kiya-z/android-reversing-challenges/tree/master/apks/KXCTF.apk" target="_blank" rel="external">KXCTF.apk</a></p>
<h2 id="RC4-åŠ å¯†"><a href="#RC4-åŠ å¯†" class="headerlink" title="RC4 åŠ å¯†"></a>RC4 åŠ å¯†</h2><p>å¯¹ç§°æ€§åŠ å¯†ã€‚ç”±<code>ä¼ªéšæœºæ•°ç”Ÿæˆå™¨å’Œå¼‚æˆ–è¿ç®—</code>ç»„æˆã€‚å¯†é’¥é•¿åº¦èŒƒå›´æ˜¯[1,255]ã€‚<br>RC4ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚åœ°åŠ è§£å¯†ã€‚ç»™å®šä¸€ä¸ªå¯†é’¥ï¼Œä¼ªéšæœºæ•°ç”Ÿæˆå™¨æ¥å—å¯†é’¥å¹¶äº§ç”Ÿä¸€ä¸ªSç›’ã€‚Sç›’ç”¨æ¥åŠ å¯†æ•°æ®ï¼Œè€Œä¸”åœ¨åŠ å¯†è¿‡ç¨‹ä¸­Sç›’ä¼šå˜åŒ–ã€‚</p>
<p><em>ä¼ªä»£ç ï¼š</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">for i from 0 to 255</div><div class="line">    S[i] := i</div><div class="line">endfor</div><div class="line">j := 0</div><div class="line">for( i=0 ; i&lt;256 ; i++)</div><div class="line">    j := (j + S[i] + key[i mod keylength]) % 256</div><div class="line">    swap values of S[i] and S[j]</div><div class="line">endfor</div><div class="line"></div><div class="line">i := 0</div><div class="line">j := 0</div><div class="line">while GeneratingOutput:</div><div class="line">    i := (i + 1) mod 256   //a</div><div class="line">    j := (j + S[i]) mod 256 //b</div><div class="line">    swap values of S[i] and S[j]  //c</div><div class="line">    k := inputByte ^ S[(S[i] + S[j]) % 256]</div><div class="line">    output K</div><div class="line">endwhile</div></pre></td></tr></table></figure>
<p><strong>ä¾‹ï¼š</strong><a href="https://github.com/kiya-z/android-reversing-challenges/tree/master/apks/rfchen.apk" target="_blank" rel="external">rfchen.apk</a></p>
<h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><p><a href="https://github.com/toToCW/CTF-Mobile" target="_blank" rel="external">CTF-Mobile</a></p>
<p><a href="https://github.com/ctfs/write-ups-2015" target="_blank" rel="external">write-ups-2015</a></p>
<p><a href="https://github.com/ctfs/write-ups-2016" target="_blank" rel="external">write-ups-2016</a></p>
<p><a href="http://bbs.pediy.com/" target="_blank" rel="external">çœ‹é›ªè®ºå›</a></p>

            
        
        </div>
        
            
            
    <hr class="copy-line">
    <div class="post-copyright">
        <div class="copy-author">
            <span>ä½œè€… :</span>
            <span>kiya</span>
        </div>
        <div class="copy-url">
            <span>åœ°å€ :</span>
            <a href="http://kiya.studio/2333/03/03/android-reversing-skills/">http://kiya.studio/2333/03/03/android-reversing-skills/</a>
        </div>
        <div class="copy-origin">
            <span>æ¥æº :</span>
            <a href="http://kiya.studio">http://kiya.studio</a>
        </div>
        <div class="copy-license">
            
            è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ï¼Œè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒã€‚
        </div>
    </div>

        
    </article>
    
        
    <nav class="article-page">
        
        
            <a href="/2017/06/21/android-gdb/" id="art-right" class="art-left">
                <span class="prev-title"> 
                    <i class="iconfont icon-left"></i>gdb è°ƒè¯• Android app
                </span>
            </a>
        
    </nav>

        
    


        </main>
        <footer class="footer syuanpi fadeIn" id="footer">
    <hr>
    <div class="footer-wrapper">
        <div class="left">
            <div class="contact-icon">
    
    
    
    
    
    
    
    
        
        
        
        
        
        
        
            <a href="https://www.instagram.com/kiyadayo" class="iconfont icon-ins" title="instagram"></a>
        
    
        
            <a href="https://github.com/kiya-z" class="iconfont icon-github" title="github"></a>
        
        
        
        
        
        
        
    
</div>
        </div>
        <div class="right">
            <div class="copyright">
    <div class="info">
        <span>&copy;</span>
        <span>2015 ~ 2017</span>
        <span>â¤</span>
        <span>kiya</span>
    </div>
    <div class="theme">
        <span>
            åŠ¨åŠ›æ¥æºäº
            <a href="http://hexo.io/" target="_blank">Hexo </a>
        </span>
        <span>
            ä¸»é¢˜
            <a href="https://github.com/ColMugX/hexo-theme-Nlvi"> Nlvi </a>
        </span>
    </div>
    
</div>
        </div>
    </div>
</footer>
    </div>
    <script src="/script/nlvi.js"></script>
<script src="/script/search.js"></script>

    <script src="/lightbox/js/lightbox.min.js"></script>

<script>
$(document).ready(function(){
    document.body.addEventListener('touchstart', function () {});
    $('.progress').hide();
    $('.body').show();
    Nlvi.tagcloud();
    Nlvi.back2top();
    Nlvi.showToc();
    Nlvi.showComments();
    Nlvi.showReward();

    !CONFIG.animate && Nlvi.offAnimate();
    CONFIG.lightbox && Nlvi.onPicBox();
})
</script>
    </div>
    
        
    <div class="post-toc">
        <span class="title">æ–‡ç« ç›®å½•</span>
        <div class="toc-inner syuanpi back-1 fallIn-light">
            <li class="title-link"><a href="javascript:;" class="toTop">Android é€†å‘æŠ€å·§æ€»ç»“</a></li>
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JNI-Onload-ä¸­é€šè¿‡-RegisterNatives-åŠ¨æ€æ³¨å†Œ-jni-å‡½æ•°"><span class="toc-text">JNI_Onload ä¸­é€šè¿‡ RegisterNatives åŠ¨æ€æ³¨å†Œ jni å‡½æ•°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#init-array"><span class="toc-text">.init_array</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dex-ç»“æ„"><span class="toc-text">dex ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¿®å¤-dexHeader-amp-onCreate"><span class="toc-text">ä¿®å¤ dexHeader & onCreate</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hook-ç³»ç»Ÿå‡½æ•°"><span class="toc-text">hook ç³»ç»Ÿå‡½æ•°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dump-å†…å­˜æœç´¢-flag"><span class="toc-text">dump å†…å­˜æœç´¢ flag</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-åˆ©ç”¨-ddms-çš„-dump-HPROF-file-åŠŸèƒ½-å¸¦ç®­å¤´çš„æ²¹æ¡¶å›¾æ ‡"><span class="toc-text">1. åˆ©ç”¨ ddms çš„ dump HPROF file åŠŸèƒ½ (å¸¦ç®­å¤´çš„æ²¹æ¡¶å›¾æ ‡)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-åˆ©ç”¨-gore"><span class="toc-text">2. åˆ©ç”¨ gore</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ä¿®æ”¹-smali-ä»£ç "><span class="toc-text">ä¿®æ”¹ smali ä»£ç </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ARM"><span class="toc-text">ARM</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ARM-çš„å‚æ•°ä¼ é€’è§„åˆ™"><span class="toc-text">ARM çš„å‚æ•°ä¼ é€’è§„åˆ™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ARM-çš„å¯„å­˜å™¨è§„åˆ™"><span class="toc-text">ARM çš„å¯„å­˜å™¨è§„åˆ™</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#å„ç§æ£€æµ‹"><span class="toc-text">å„ç§æ£€æµ‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#dex-æ ¡éªŒ"><span class="toc-text">dex æ ¡éªŒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#åè°ƒè¯•"><span class="toc-text">åè°ƒè¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#å»èŠ±"><span class="toc-text">å»èŠ±</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#åŠ å¯†ç®—æ³•"><span class="toc-text">åŠ å¯†ç®—æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DES-åŠ å¯†"><span class="toc-text">DES åŠ å¯†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RC6-åŠ å¯†"><span class="toc-text">RC6 åŠ å¯†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RC4-åŠ å¯†"><span class="toc-text">RC4 åŠ å¯†</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#reference"><span class="toc-text">reference</span></a></li></ol>
        </div>
    </div>

    
    <div class="backtop syuanpi dead toTop" id="backtop">
    <i class="iconfont icon-up"></i>
    <span style="text-align:center;font-family:Georgia;"><span style="font-family:Georgia;" id="scrollpercent">1</span>%</span>
</div>
    
    <div class="search" id="search">
        <div class="mask" id="mask"></div>
        <div class="search-wrapper syuanpi">
            <h1 id="search-header" class="syuanpi">æ‰¾å•¥å‘¢</h1>
            <div class="input">
                <input type="text" id="local-search-input" results="0" name="">
            </div>
            <div id="local-search-result"></div>
        </div>
    </div>
    <script>
    var GREETING = {
        morning: "ãŠã¯ã‚ˆã†",
        noon: "ã“ã‚“ã«ã¡ã¯",
        after: "ã“ã‚“ã«ã¡ã¯",
        night: "ã“ã‚“ã°ã‚“ã¯",
        midnight: "ãŠã‚„ã™ã¿"
    }
    $(document).ready(function(){
        Nlvi.search();
    });
    </script>

</body>
</html>
